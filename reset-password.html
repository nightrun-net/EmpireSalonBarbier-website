<!DOCTYPE html>
<html>
<head><title>Debug Reset</title></head>
<body>
  <input type="email" id="email" placeholder="Email" /><br/>
  <input type="password" id="password" placeholder="New Password" /><br/>
  <button id="btn">Reset Password</button>
  <pre id="output"></pre>

  <script>
    const btn = document.getElementById('btn');
    const output = document.getElementById('output');
    const params = new URLSearchParams(window.location.hash.slice(1));
    const token = params.get('access_token');
    const type = params.get('type');

    if (!token || type !== 'recovery') {
      output.textContent = "Invalid or missing token.";
      btn.disabled = true;
    }

    btn.addEventListener('click', async () => {
      const email = document.getElementById('email').value.trim();
      const password = document.getElementById('password').value.trim();

      output.textContent = '';

      if (!email || !password) {
        output.textContent = "Email and password are required.";
        return;
      }

      try {
        output.textContent = 'Sending request...';
        const res = await fetch('https://afjtomvxgyqxkzpbjamb.supabase.co/auth/v1/user', {
          method: 'PUT',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${token}`
          },
          body: JSON.stringify({ email, password })
        });
        const data = await res.json();

        if (!res.ok) {
          output.textContent = "Error: " + JSON.stringify(data, null, 2);
        } else {
          output.textContent = "Success! Password reset.";
        }
      } catch (e) {
        output.textContent = "Fetch error: " + e.message;
      }
    });
  </script>
</body>
</html>

